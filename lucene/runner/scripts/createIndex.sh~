#!/bin/bash
source $(dirname $0)/elfenSetting.sh

if [ -d "${INDEX_DIR}" ]; then
    echo "Index ${INDEX_DIR} exists."
    exit 0;
fi

echo "Create index directory ${INDEX_DIR}. It may take hours!"

java -server -Xms2g -Xmx2g -XX:-TieredCompilation -XX:+HeapDumpOnOutOfMemoryError -Xbatch -classpath "${LUCENE_BUILD}/core/classes/java:${LUCENE_BUILD}/core/classes/test:${LUCENE_BUILD}/sandbox/classes/java:${LUCENE_BUILD}/misc/classes/java:${LUCENE_BUILD}/facet/classes/java:${LUCENE_BUILD}/analysis/common/classes/java:${LUCENE_BUILD}/analysis/icu/classes/java:${LUCENE_BUILD}/queryparser/classes/java:${LUCENE_BUILD}/grouping/classes/java:${LUCENE_BUILD}/suggest/classes/java:${LUCENE_BUILD}/highlighter/classes/java:${LUCENE_BUILD}/codecs/classes/java:${LUCENE_BUILD}/queries/classes/java:${LUCENE_UTIL}/lib/HdrHistogram.jar:${TARGET_DIR}" perf.Indexer -dirImpl MMapDirectory -indexPath ${INDEX_DIR} -analyzer StandardAnalyzer -lineDocsFile ${SOURCE_DATA} -docCountLimit 10000000 -threadCount 1 -maxConcurrentMerges 1 -ramBufferMB -1 -maxBufferedDocs 18 -postingsFormat Lucene50 -waitForMerges -mergePolicy LogDocMergePolicy -idFieldPostingsFormat Memory -grouping
